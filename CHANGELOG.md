## 2025-11-23

### ğŸ¨ ä¿®å¤ - ç§»åŠ¨ç«¯é¡µé¢å¤šä½™çš„é¡¶éƒ¨å¯¼èˆªæ 

**é—®é¢˜æè¿°**:
- ä¸ªäººä¿¡æ¯ï¼ˆ`/profile/edit`ï¼‰ã€ç”Ÿæˆå†å²ï¼ˆ`/history`ï¼‰ã€è®¾ç½®ï¼ˆ`/settings`ï¼‰é¡µé¢æ˜¾ç¤ºå¤šä½™çš„è·¯ç”±å¯¼èˆªä¿¡æ¯
- é¡µé¢é¡¶éƒ¨å‡ºç° "tabs" æŒ‰é’®æˆ–è·¯ç”±è·¯å¾„æ˜¾ç¤ºï¼Œå½±å“ç”¨æˆ·ä½“éªŒ

**è§£å†³æ–¹æ¡ˆ**:
- åœ¨ `mobile-app/app/_layout.tsx` ä¸­ä¸º Stack è®¾ç½®å…¨å±€ `screenOptions={{ headerShown: false }}`
- æ˜ç¡®é…ç½®æ‰€æœ‰ç‹¬ç«‹é¡µé¢è·¯ç”±ï¼Œç¡®ä¿ä¸æ˜¾ç¤ºç³»ç»Ÿé»˜è®¤çš„ header

**ä¿®æ”¹æ–‡ä»¶**:
- âœ… `mobile-app/app/_layout.tsx` - é…ç½®è·¯ç”±ï¼Œéšè—é»˜è®¤ header

**æ•ˆæœ**:
- âœ… ä¸ªäººä¿¡æ¯é¡µé¢ï¼šåªæ˜¾ç¤ºè‡ªå®šä¹‰çš„é¡¶éƒ¨å¯¼èˆªæ ï¼ˆè¿”å›æŒ‰é’® + æ ‡é¢˜ + ä¿å­˜æŒ‰é’®ï¼‰
- âœ… ç”Ÿæˆå†å²é¡µé¢ï¼šåªæ˜¾ç¤ºè‡ªå®šä¹‰çš„é¡¶éƒ¨å¯¼èˆªæ ï¼ˆè¿”å›æŒ‰é’® + æ ‡é¢˜ + æ¸…ç†æŒ‰é’®ï¼‰
- âœ… è®¾ç½®é¡µé¢ï¼šåªæ˜¾ç¤ºè‡ªå®šä¹‰çš„é¡¶éƒ¨å¯¼èˆªæ ï¼ˆè¿”å›æŒ‰é’® + æ ‡é¢˜ï¼‰
- âœ… é¡µé¢å¸ƒå±€æ›´åŠ ç®€æ´ç¾è§‚

---

### ğŸ”’ ä¿®å¤ - ç§»åŠ¨ç«¯Bearer Tokenè®¤è¯å’ŒRLSæƒé™é—®é¢˜

**é—®é¢˜æè¿°**: 
- ç§»åŠ¨ç«¯è°ƒç”¨APIæ—¶ä½¿ç”¨Bearer tokenè®¤è¯ï¼Œä½†åç«¯APIä¾èµ–Cookieè®¤è¯
- å¯¼è‡´ç§»åŠ¨ç«¯è¯·æ±‚è¿”å›401æœªæˆæƒé”™è¯¯
- é”™è¯¯æ—¥å¿—æ˜¾ç¤º: `Auth session missing!`, `User stats API - unauthorized`
- å³ä½¿è®¤è¯æˆåŠŸï¼Œ`getTeamForUser()` ä¹Ÿæ— æ³•è·å–å›¢é˜Ÿä¿¡æ¯ï¼Œå› ä¸º:
  1. å®ƒå†…éƒ¨è°ƒç”¨äº†åªæ”¯æŒCookieçš„è®¤è¯
  2. æŸ¥è¯¢æ•°æ®åº“æ—¶ä½¿ç”¨çš„ Supabase å®¢æˆ·ç«¯æ²¡æœ‰æ­£ç¡®çš„ Bearer token è®¤è¯ä¸Šä¸‹æ–‡
  3. Supabase RLSï¼ˆè¡Œçº§å®‰å…¨ï¼‰ç­–ç•¥é˜»æ­¢äº†æœªæ­£ç¡®è®¤è¯çš„æŸ¥è¯¢

**æ ¹æœ¬åŸå› **:
- Supabase çš„ RLS ç­–ç•¥è¦æ±‚æŸ¥è¯¢ä½¿ç”¨æ­£ç¡®çš„è®¤è¯ä¸Šä¸‹æ–‡
- å³ä½¿ä¼ å…¥äº† `user.id`ï¼Œå¦‚æœ Supabase å®¢æˆ·ç«¯æ²¡æœ‰ç›¸åº”çš„ Bearer tokenï¼ŒRLS ä»ä¼šæ‹’ç»è®¿é—®
- `createSupabaseServer()` åªæ”¯æŒ Cookie è®¤è¯ï¼Œæ— æ³•å¤„ç†ç§»åŠ¨ç«¯çš„ Bearer token

**è§£å†³æ–¹æ¡ˆ**:
1. åˆ›å»ºç»Ÿä¸€è®¤è¯è¾…åŠ©å‡½æ•° `getAuthenticatedUser(req)` - åŒæ—¶æ”¯æŒ:
   - Bearer Token è®¤è¯ï¼ˆç§»åŠ¨ç«¯ï¼‰- ä» Authorization header è·å–
   - Cookie è®¤è¯ï¼ˆWebç«¯ï¼‰- ä» Cookie è·å–
2. åˆ›å»º `createAuthenticatedSupabaseFromRequest(req)` - æ ¹æ®è¯·æ±‚åˆ›å»ºå¸¦æœ‰æ­£ç¡®è®¤è¯ä¸Šä¸‹æ–‡çš„ Supabase å®¢æˆ·ç«¯
3. æ›´æ–°æ‰€æœ‰éœ€è¦è®¤è¯çš„APIç«¯ç‚¹ä½¿ç”¨æ–°çš„è®¤è¯å‡½æ•°å’Œå®¢æˆ·ç«¯
4. ä¿®æ”¹æ•°æ®åº“æŸ¥è¯¢å‡½æ•°ï¼Œæ”¯æŒä¼ å…¥å·²è®¤è¯çš„ Supabase å®¢æˆ·ç«¯ï¼Œç¡®ä¿ RLS ç­–ç•¥é€šè¿‡

**æ–°å¢æ–‡ä»¶**:
- âœ… `lib/supabase/auth-helper.ts` - ç»Ÿä¸€è®¤è¯è¾…åŠ©å‡½æ•°ï¼ˆ120è¡Œï¼‰
  - `getAuthenticatedUser(req)` - è·å–è®¤è¯ç”¨æˆ·
  - `getAuthenticatedSupabaseClient(req)` - è·å–è®¤è¯å®¢æˆ·ç«¯å’Œç”¨æˆ·
  - `createAuthenticatedSupabaseFromRequest(req)` - åˆ›å»ºå¸¦è®¤è¯çš„ Supabase å®¢æˆ·ç«¯

**ä¿®æ”¹çš„APIç«¯ç‚¹**:
- âœ… `app/api/user/stats/route.ts` - ç”¨æˆ·ç»Ÿè®¡API
- âœ… `app/api/user/generations/route.ts` - ç”Ÿæˆå†å²API (GET/DELETE)
- âœ… `app/api/user/route.ts` - ç”¨æˆ·ä¿¡æ¯API
- âœ… `app/api/credits/route.ts` - ç§¯åˆ†ä¿¡æ¯API

**ä¿®æ”¹çš„æ•°æ®åº“æŸ¥è¯¢å‡½æ•°** (`lib/db/queries.ts`):
- âœ… `getTeamForUser(providedUser?, providedSupabase?)` - æ”¯æŒä¼ å…¥å·²è®¤è¯ç”¨æˆ·å’Œ Supabase å®¢æˆ·ç«¯
- âœ… `getUserTeamCredits(providedUser?)` - æ”¯æŒä¼ å…¥å·²è®¤è¯ç”¨æˆ·
- âœ… `getUserTeamSubscriptionInfo(providedUser?)` - æ”¯æŒä¼ å…¥å·²è®¤è¯ç”¨æˆ·
- âœ… `getUserTeamCreditHistory(limit, providedUser?)` - æ”¯æŒä¼ å…¥å·²è®¤è¯ç”¨æˆ·
- âœ… `getActivityLogs(providedUser?)` - æ”¯æŒä¼ å…¥å·²è®¤è¯ç”¨æˆ·

**æŠ€æœ¯ç»†èŠ‚**:
```typescript
// API è·¯ç”±ä¸­çš„æ­£ç¡®ä½¿ç”¨æ–¹å¼:
// 1. è·å–è®¤è¯ç”¨æˆ·
const user = await getAuthenticatedUser(req);
if (!user) {
  return NextResponse.json({ error: "unauthorized" }, { status: 401 });
}

// 2. åˆ›å»ºå¸¦æœ‰æ­£ç¡®è®¤è¯ä¸Šä¸‹æ–‡çš„ Supabase å®¢æˆ·ç«¯
const supa = await createAuthenticatedSupabaseFromRequest(req);

// 3. ä¼ å…¥ç”¨æˆ·å’Œå®¢æˆ·ç«¯è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼ˆç¡®ä¿ RLS ç­–ç•¥é€šè¿‡ï¼‰
const team = await getTeamForUser(user, supa);

// è®¤è¯ä¼˜å…ˆçº§:
1. ä¼˜å…ˆæ£€æŸ¥ Authorization: Bearer <token> headerï¼ˆç§»åŠ¨ç«¯ï¼‰
2. å¦‚æœä¸å­˜åœ¨ï¼Œå›é€€åˆ° Cookie è®¤è¯ï¼ˆWebç«¯ï¼‰
3. éƒ½å¤±è´¥è¿”å› 401
```

**æµ‹è¯•è¦ç‚¹**:
- âœ… ç§»åŠ¨ç«¯ç™»å½•åèƒ½æˆåŠŸè°ƒç”¨ `/api/user/stats` å¹¶è·å–æ­£ç¡®çš„å›¢é˜Ÿä¿¡æ¯
- âœ… ç§»åŠ¨ç«¯ç™»å½•åèƒ½æˆåŠŸè°ƒç”¨ `/api/user/generations` å¹¶è·å–å†å²è®°å½•
- âœ… ç§»åŠ¨ç«¯ç™»å½•åèƒ½æˆåŠŸè°ƒç”¨ `/api/user` å’Œ `/api/credits` å¹¶æ˜¾ç¤ºæ­£ç¡®çš„å¥—é¤çº§åˆ«
- âœ… ç§»åŠ¨ç«¯æ˜¾ç¤ºçš„ç”¨æˆ·ä¿¡æ¯ä¸Webç«¯ä¸€è‡´ï¼ˆå¥—é¤ã€ç§¯åˆ†ã€å†å²è®°å½•ï¼‰
- âœ… Webç«¯Cookieè®¤è¯ä»ç„¶æ­£å¸¸å·¥ä½œ
- âœ… æœªç™»å½•è¯·æ±‚æ­£ç¡®è¿”å›401
- âœ… åç«¯æ—¥å¿—ä¸å†æ˜¾ç¤º "No team found" é”™è¯¯

---

### ğŸ“± æ–°å¢ - ç§»åŠ¨ç«¯Appå®Œæ•´ç™»å½•åŠŸèƒ½ï¼ˆå«æ‰‹æœºå·ç™»å½•ï¼‰

**è¯´æ˜**: ä¸ºç§»åŠ¨ç«¯Appæ·»åŠ å®Œæ•´çš„ç™»å½•åŠŸèƒ½ï¼ŒåŒ…æ‹¬é‚®ç®±ç™»å½•ã€Google OAuthã€æ‰‹æœºå·éªŒè¯ç ç™»å½•ã€è®¤è¯çŠ¶æ€ç®¡ç†å’Œç™»å½•å®ˆå«ï¼Œä¸Webç«¯ä¿æŒä¸€è‡´çš„ç”¨æˆ·ä½“éªŒã€‚

**æ–°å¢æ–‡ä»¶**:
- âœ… `mobile-app/components/LoginModal.tsx` - ç™»å½•å¼¹çª—ç»„ä»¶ (650è¡Œ)
- âœ… `mobile-app/contexts/AuthContext.tsx` - è®¤è¯çŠ¶æ€ç®¡ç† Context (120è¡Œ)

**ä¿®æ”¹æ–‡ä»¶**:
- âœ… `mobile-app/app/_layout.tsx` - æ ¹å¸ƒå±€æ·»åŠ  AuthProvider
- âœ… `mobile-app/app/welcome.tsx` - æ¬¢è¿é¡µé¢é›†æˆç™»å½•æ£€æµ‹å’Œå¼¹çª—è§¦å‘
- âœ… `mobile-app/app/(tabs)/image-generation.ios.tsx` - iOSå›¾ç‰‡ç”Ÿæˆé¡µæ·»åŠ ç™»å½•å®ˆå«
- âœ… `mobile-app/app/(tabs)/image-generation.tsx` - Androidå›¾ç‰‡ç”Ÿæˆé¡µæ·»åŠ ç™»å½•å®ˆå«

**æ ¸å¿ƒåŠŸèƒ½**:

1. **ç™»å½•å¼¹çª—ç»„ä»¶ (LoginModal)**:
   - ä¸‰ç§ç™»å½•æ–¹å¼é€‰æ‹©ç•Œé¢ï¼ˆé‚®ç®±/Google/æ‰‹æœºå·ï¼‰
   - é‚®ç®±ç™»å½•/æ³¨å†Œè¡¨å•ï¼ˆå«å¯†ç å¯è§æ€§åˆ‡æ¢ï¼‰
   - Google OAuth ç™»å½•ï¼ˆä½¿ç”¨ expo-web-browser + expo-auth-sessionï¼‰
   - **æ‰‹æœºå·éªŒè¯ç ç™»å½•**ï¼ˆå®Œæ•´å®ç°ï¼‰:
     * æ”¯æŒå¤šå›½åŒºå·é€‰æ‹©ï¼ˆ+86ä¸­å›½ã€+1ç¾å›½ç­‰13ä¸ªå›½å®¶ï¼‰
     * éªŒè¯ç å‘é€ä¸å€’è®¡æ—¶ï¼ˆ60ç§’ï¼‰
     * 6ä½éªŒè¯ç è¾“å…¥
     * OTPéªŒè¯ä¸è‡ªåŠ¨ç™»å½•
   - ç”¨æˆ·åè®®å’Œéšç§æ”¿ç­–å‹¾é€‰
   - å‹å¥½çš„é”™è¯¯æç¤ºå’ŒæˆåŠŸæ¶ˆæ¯
   - è‡ªåŠ¨å…³é—­å¹¶è·³è½¬

2. **è®¤è¯çŠ¶æ€ç®¡ç† (AuthContext)**:
   - å…¨å±€è®¤è¯çŠ¶æ€ç®¡ç†
   - ç›‘å¬ Supabase Auth çŠ¶æ€å˜åŒ–
   - è‡ªåŠ¨åˆ·æ–°ç”¨æˆ·ä¿¡æ¯
   - æä¾› `useAuth` Hook æ–¹ä¾¿è°ƒç”¨
   - æä¾› `useRequireAuth` Hook æ£€æŸ¥ç™»å½•çŠ¶æ€
   - æ”¯æŒä¼šè¯æŒä¹…åŒ–ï¼ˆAsyncStorageï¼‰

3. **ç™»å½•æµç¨‹**:
```
ç”¨æˆ·æµç¨‹ï¼š
1. ç”¨æˆ·è®¿é—® welcome é¡µé¢
   â†“
2. ç‚¹å‡»"ç«‹å³å¼€å§‹"æŒ‰é’®
   â†“
3. æ£€æŸ¥ç™»å½•çŠ¶æ€
   - å·²ç™»å½• â†’ ç›´æ¥è·³è½¬åˆ°å›¾ç‰‡ç”Ÿæˆé¡µ
   - æœªç™»å½• â†’ æ˜¾ç¤ºç™»å½•å¼¹çª—
   â†“
4. åœ¨ç™»å½•å¼¹çª—ä¸­é€‰æ‹©ç™»å½•æ–¹å¼ï¼š
   a. é‚®ç®±ç™»å½•ï¼š
      - è¾“å…¥é‚®ç®±å’Œå¯†ç 
      - å¯åˆ‡æ¢ç™»å½•/æ³¨å†Œæ¨¡å¼
      - å‹¾é€‰åè®® â†’ æäº¤
   
   b. Googleç™»å½•ï¼š
      - å‹¾é€‰åè®®
      - æ‰“å¼€æµè§ˆå™¨å®ŒæˆOAuth
      - è‡ªåŠ¨è¿”å›
   
   c. æ‰‹æœºå·ç™»å½•ï¼ˆæ–°å¢ï¼‰ï¼š
      - é€‰æ‹©å›½å®¶åŒºå·ï¼ˆé»˜è®¤+86ï¼‰
      - è¾“å…¥æ‰‹æœºå·
      - ç‚¹å‡»"å‘é€éªŒè¯ç "
      - è¾“å…¥6ä½éªŒè¯ç 
      - å‹¾é€‰åè®® â†’ æäº¤ç™»å½•
   â†“
5. ç™»å½•æˆåŠŸ
   - å…³é—­å¼¹çª—
   - è‡ªåŠ¨è·³è½¬åˆ°å›¾ç‰‡ç”Ÿæˆé¡µ
   â†“
6. åœ¨åŠŸèƒ½é¡µé¢ä¸­ï¼š
   - ç‚¹å‡»æ¨¡æ¿æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
   - æœªç™»å½• â†’ æ˜¾ç¤ºç™»å½•å¼¹çª—
   - å·²ç™»å½• â†’ æ‰“å¼€ä¸Šä¼ å¯¹è¯æ¡†
```

4. **ç™»å½•å®ˆå«å®ç°**:
   - Welcome é¡µé¢ï¼šæ£€æµ‹ç™»å½•çŠ¶æ€ï¼Œå·²ç™»å½•è‡ªåŠ¨è·³è½¬
   - å›¾ç‰‡ç”Ÿæˆé¡µï¼šç‚¹å‡»æ¨¡æ¿æ—¶æ£€æŸ¥ç™»å½•ï¼Œæœªç™»å½•å¼¹å‡ºç™»å½•çª—
   - ä¸Šä¼ å›¾ç‰‡ï¼šåœ¨ uploadImage å‡½æ•°ä¸­éªŒè¯ä¼šè¯ä»¤ç‰Œ
   - API è°ƒç”¨ï¼šè‡ªåŠ¨é™„åŠ  Authorization header

5. **OAuth é›†æˆ**:
   - ä½¿ç”¨ `expo-web-browser` æ‰“å¼€å¤–éƒ¨æµè§ˆå™¨
   - ä½¿ç”¨ `expo-auth-session` å¤„ç†å›è°ƒ
   - Deep Link é…ç½®ï¼š`monna://auth/callback`
   - æ”¯æŒ PKCE æµç¨‹ï¼ˆå®‰å…¨ï¼‰

6. **UI/UX ç‰¹æ€§**:
   - æ¯›ç»ç’ƒæ•ˆæœèƒŒæ™¯
   - å¹³æ»‘çš„æ¨¡æ€åŠ¨ç”»
   - é”®ç›˜è‡ªé€‚åº”å¸ƒå±€
   - åŠ è½½çŠ¶æ€æŒ‡ç¤º
   - é”™è¯¯æç¤ºé«˜äº®
   - æˆåŠŸæç¤ºåé¦ˆ

**æŠ€æœ¯å®ç°ç»†èŠ‚**:

```typescript
// AuthContext çŠ¶æ€ç®¡ç†
interface AuthContextType {
  user: User | null;
  session: Session | null;
  loading: boolean;
  signOut: () => Promise<void>;
  refreshUser: () => Promise<void>;
}

// ç™»å½•å¼¹çª—æ¥å£
interface LoginModalProps {
  visible: boolean;
  onClose: () => void;
  onSuccess: () => void;
}

// ç™»å½•æ–¹æ³•é€‰æ‹©
type LoginMethod = 'email' | 'phone' | null;

// ç™»å½•æ¨¡å¼
type Mode = 'signin' | 'signup';
```

**ä¾èµ–é¡¹å®‰è£…**:
```bash
cd mobile-app
npm install @supabase/supabase-js@^2.39.0 @react-native-async-storage/async-storage@^2.1.0 expo-auth-session@^6.0.6 --legacy-peer-deps
```

**ä¾èµ–è¯´æ˜**:
- `@supabase/supabase-js@^2.39.0` - Supabase å®¢æˆ·ç«¯ï¼Œæä¾›è®¤è¯æœåŠ¡
- `expo-web-browser@^15.0.6` - OAuth æµè§ˆå™¨ï¼ˆå·²åŒ…å«åœ¨ Expoï¼‰
- `expo-auth-session@^6.0.6` - OAuth ä¼šè¯å¤„ç†å’Œ Deep Link æ”¯æŒ
- `@react-native-async-storage/async-storage@^2.1.0` - ä¼šè¯æŒä¹…åŒ–å­˜å‚¨
- `@expo/vector-icons@^15.0.2` - å›¾æ ‡åº“ï¼ˆå·²åŒ…å«åœ¨ Expoï¼‰

**æ‰‹æœºå·ç™»å½•æŠ€æœ¯å®ç°**:
```typescript
// 1. å‘é€éªŒè¯ç 
const { data, error } = await supabase.auth.signInWithOtp({
  phone: `${countryCode}${phone}`,  // ä¾‹å¦‚: +8613800138000
  options: { channel: 'sms' }
});

// 2. éªŒè¯OTPå¹¶ç™»å½•
const { data, error } = await supabase.auth.verifyOtp({
  phone: phoneNumber,
  token: verificationCode,  // 6ä½éªŒè¯ç 
  type: 'sms'
});

// 3. ç™»å½•æˆåŠŸè‡ªåŠ¨åˆ›å»ºç”¨æˆ·è®°å½•
if (data.user) {
  // ç”¨æˆ·å·²ç™»å½•ï¼Œä¼šè¯å·²åˆ›å»º
  onSuccess(); // è·³è½¬åˆ°ä¸»é¡µé¢
}
```

**æ”¯æŒçš„å›½å®¶åŒºå·**:
- ğŸ‡¨ğŸ‡³ +86 (ä¸­å›½)
- ğŸ‡ºğŸ‡¸ +1 (ç¾å›½)
- ğŸ‡¬ğŸ‡§ +44 (è‹±å›½)
- ğŸ‡¯ğŸ‡µ +81 (æ—¥æœ¬)
- ğŸ‡°ğŸ‡· +82 (éŸ©å›½)
- ğŸ‡¸ğŸ‡¬ +65 (æ–°åŠ å¡)
- ğŸ‡­ğŸ‡° +852 (é¦™æ¸¯)
- ğŸ‡¹ğŸ‡¼ +886 (å°æ¹¾)
- ğŸ‡¦ğŸ‡º +61 (æ¾³å¤§åˆ©äºš)
- ğŸ‡©ğŸ‡ª +49 (å¾·å›½)
- ğŸ‡«ğŸ‡· +33 (æ³•å›½)
- ğŸ‡®ğŸ‡¹ +39 (æ„å¤§åˆ©)
- ğŸ‡·ğŸ‡º +7 (ä¿„ç½—æ–¯)

**ä¸Webç«¯å¯¹æ¯”**:
| åŠŸèƒ½ | Webç«¯ | ç§»åŠ¨ç«¯ |
|------|-------|--------|
| é‚®ç®±ç™»å½• | âœ… | âœ… |
| Google OAuth | âœ… | âœ… |
| Apple OAuth | âœ… | ğŸš§ (å¾…å®ç°) |
| æ‰‹æœºå·ç™»å½• | âœ… | âœ… **(æ–°å¢)** |
| éªŒè¯ç å€’è®¡æ—¶ | âœ… | âœ… |
| ç™»å½•å¼¹çª— | âœ… | âœ… |
| è‡ªåŠ¨è·³è½¬ | âœ… | âœ… |
| ä¼šè¯æŒä¹…åŒ– | âœ… | âœ… |

**æµ‹è¯•è¦ç‚¹**:
1. âœ… æœªç™»å½•è®¿é—® welcome é¡µé¢ï¼Œç‚¹å‡»"ç«‹å³å¼€å§‹"å¼¹å‡ºç™»å½•çª—
2. âœ… é‚®ç®±ç™»å½•/æ³¨å†ŒåŠŸèƒ½æ­£å¸¸
3. âœ… Google OAuth ç™»å½•æ­£å¸¸
4. âœ… **æ‰‹æœºå·ç™»å½•æµç¨‹**:
   - è¾“å…¥æ‰‹æœºå·ï¼Œç‚¹å‡»"å‘é€éªŒè¯ç "
   - å€’è®¡æ—¶60ç§’æ˜¾ç¤ºæ­£ç¡®
   - è¾“å…¥6ä½éªŒè¯ç 
   - éªŒè¯æˆåŠŸåè‡ªåŠ¨ç™»å½•
   - é”™è¯¯æç¤ºå‹å¥½ï¼ˆéªŒè¯ç é”™è¯¯ã€è¿‡æœŸç­‰ï¼‰
5. âœ… ç™»å½•æˆåŠŸåè‡ªåŠ¨è·³è½¬åˆ°å›¾ç‰‡ç”Ÿæˆé¡µ
6. âœ… å·²ç™»å½•ç”¨æˆ·è®¿é—® welcome é¡µé¢è‡ªåŠ¨è·³è½¬
7. âœ… æœªç™»å½•ç”¨æˆ·ç‚¹å‡»æ¨¡æ¿å¼¹å‡ºç™»å½•çª—
8. âœ… ç™»å½•åä¼šè¯æŒä¹…åŒ–ï¼Œé‡å¯Appä»ä¿æŒç™»å½•
9. âœ… ç™»å‡ºåŠŸèƒ½æ­£å¸¸
10. âœ… ç™»å½•å¯¹è¯æ¡†å±…ä¸­æ˜¾ç¤ºï¼ˆå·²ä¿®å¤åº•éƒ¨è¢«é®æŒ¡é—®é¢˜ï¼‰

**UI/UXä¿®å¤**:
- âœ… ä¿®å¤ç™»å½•å¯¹è¯æ¡†è¢«æ¨åˆ°å±å¹•åº•éƒ¨çš„é—®é¢˜
- âœ… å¯¹è¯æ¡†å±…ä¸­æ˜¾ç¤ºï¼Œä½¿ç”¨æ·¡å…¥åŠ¨ç”»
- âœ… æ·»åŠ é˜´å½±æ•ˆæœå’Œåœ†è§’
- âœ… å“åº”å¼å¸ƒå±€ï¼Œé€‚é…ä¸åŒå±å¹•å°ºå¯¸

**åç»­ä¼˜åŒ–**:
- [ ] æ·»åŠ  Apple OAuth ç™»å½•æ”¯æŒ
- [ ] æ‰©å±•æ›´å¤šå›½å®¶åŒºå·æ”¯æŒ
- [ ] æ·»åŠ å¿˜è®°å¯†ç åŠŸèƒ½
- [ ] ä¼˜åŒ– OAuth å›è°ƒå¤„ç†
- [ ] æ·»åŠ ç”Ÿç‰©è¯†åˆ«ç™»å½•ï¼ˆæŒ‡çº¹/é¢å®¹IDï¼‰
- [ ] æ·»åŠ ç¤¾äº¤åª’ä½“ç™»å½•ï¼ˆå¾®ä¿¡ã€Facebookç­‰ï¼‰
- [ ] è®°ä½ç™»å½•çŠ¶æ€é€‰é¡¹

**çŠ¶æ€**: âœ… å·²å®Œæˆ - ç§»åŠ¨ç«¯ç™»å½•åŠŸèƒ½å®Œæ•´å¯ç”¨ï¼ˆåŒ…å«æ‰‹æœºå·ç™»å½•ï¼‰

---

## 2025-11-23 (ä¸‹åˆ)

### ğŸ“± æ–°å¢ - ç§»åŠ¨ç«¯ç”¨æˆ·ä¿¡æ¯èœå•

**è¯´æ˜**: ä¸ºç§»åŠ¨ç«¯Appæ·»åŠ ç”¨æˆ·ä¿¡æ¯èœå•ç»„ä»¶ï¼Œæ˜¾ç¤ºç”¨æˆ·å¤´åƒã€ä¸ªäººä¿¡æ¯ã€ç§¯åˆ†ä½™é¢ï¼Œå¹¶æä¾›å¿«æ·æ“ä½œå…¥å£ã€‚

**æ–°å¢æ–‡ä»¶**:
- âœ… `mobile-app/components/UserMenu.tsx` - ç”¨æˆ·èœå•ç»„ä»¶ (350è¡Œ)

**ä¿®æ”¹æ–‡ä»¶**:
- âœ… `mobile-app/components/TopNavigationBar.tsx` - é›†æˆç”¨æˆ·èœå•ç»„ä»¶

**æ ¸å¿ƒåŠŸèƒ½**:

1. **ç”¨æˆ·çŠ¶æ€æ˜¾ç¤º**:
   - æœªç™»å½•ï¼šæ˜¾ç¤º"ç™»å½•"æŒ‰é’®ï¼Œç‚¹å‡»å¼¹å‡ºç™»å½•å¼¹çª—
   - å·²ç™»å½•ï¼šæ˜¾ç¤ºç”¨æˆ·å¤´åƒï¼ˆé¦–å­—æ¯ï¼‰
   - ç‚¹å‡»å¤´åƒå¼¹å‡ºä¸‹æ‹‰èœå•

2. **ç”¨æˆ·å¤´åƒ**:
   - åœ†å½¢å¤´åƒï¼ŒèƒŒæ™¯è‰²æ©™è‰² (#FF5722)
   - æ˜¾ç¤ºç”¨æˆ·åé¦–å­—æ¯æˆ–é‚®ç®±é¦–å­—æ¯
   - 36x36 åƒç´ å¤§å°
   - ç‚¹å‡»æ‰“å¼€èœå•

3. **ä¸‹æ‹‰èœå•å†…å®¹**:
   ```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ [å¤´åƒ] ç”¨æˆ·å               â”‚
   â”‚        â­ å…è´¹ç”¨æˆ·          â”‚
   â”‚        å‰©ä½™ç§¯åˆ†: --         â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ ğŸ‘¤ ä¸ªäººä¿¡æ¯            >    â”‚
   â”‚ ğŸ• ç”Ÿæˆå†å²            >    â”‚
   â”‚ âš™ï¸  è®¾ç½®                >    â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ ğŸšª é€€å‡ºç™»å½•                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ```

4. **èœå•åŠŸèƒ½**:
   - **ä¸ªäººä¿¡æ¯**: è·³è½¬åˆ°ä¸ªäººä¿¡æ¯é¡µé¢ï¼ˆå¾…å®ç°ï¼‰
   - **ç”Ÿæˆå†å²**: æŸ¥çœ‹å†å²ç”Ÿæˆè®°å½•ï¼ˆå¾…å®ç°ï¼‰
   - **è®¾ç½®**: åº”ç”¨è®¾ç½®é¡µé¢ï¼ˆå¾…å®ç°ï¼‰
   - **é€€å‡ºç™»å½•**: ç¡®è®¤åç™»å‡ºå¹¶è·³è½¬åˆ°æ¬¢è¿é¡µ

5. **UI/UXç‰¹æ€§**:
   - èœå•ä»å³ä¸Šè§’æ»‘å‡º
   - åŠé€æ˜èƒŒæ™¯é®ç½©
   - ç‚¹å‡»å¤–éƒ¨è‡ªåŠ¨å…³é—­
   - é˜´å½±å’Œåœ†è§’æ•ˆæœ
   - é€€å‡ºç™»å½•å‰äºŒæ¬¡ç¡®è®¤

**ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºé€»è¾‘**:
```typescript
// è·å–æ˜¾ç¤ºåç§°ä¼˜å…ˆçº§
1. user.user_metadata.name (ç”¨æˆ·è®¾ç½®çš„æ˜µç§°)
2. user.email.split('@')[0] (é‚®ç®±ç”¨æˆ·åéƒ¨åˆ†)
3. "ç”¨æˆ·" (é»˜è®¤)

// è·å–å¤´åƒé¦–å­—æ¯
1. user.user_metadata.name[0] (æ˜µç§°é¦–å­—æ¯)
2. user.email[0] (é‚®ç®±é¦–å­—æ¯)
3. "U" (é»˜è®¤)
```

**é€€å‡ºç™»å½•æµç¨‹**:
```
1. ç”¨æˆ·ç‚¹å‡»"é€€å‡ºç™»å½•"
   â†“
2. å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
   â†“
3. ç”¨æˆ·ç¡®è®¤
   â†“
4. è°ƒç”¨ signOut() æ¸…é™¤ä¼šè¯
   â†“
5. å…³é—­èœå•
   â†“
6. è·³è½¬åˆ° welcome é¡µé¢
```

**æŠ€æœ¯å®ç°**:
```typescript
// 1. æœªç™»å½•çŠ¶æ€
if (!user && !loading) {
  return <LoginButton />;
}

// 2. å·²ç™»å½•çŠ¶æ€
return (
  <>
    <Avatar onClick={openMenu} />
    <Modal visible={menuVisible}>
      <UserInfoSection />
      <MenuItems />
      <SignOutButton />
    </Modal>
  </>
);
```

**é›†æˆåˆ°å¯¼èˆªæ **:
- æ›¿æ¢åŸæœ‰çš„ç®€å•"æˆ‘çš„"æŒ‰é’®
- ä½¿ç”¨æ–°çš„ `UserMenu` ç»„ä»¶
- æ”¯æŒä¼ é€’ `onOpenLoginModal` å›è°ƒ
- å“åº”å¼è®¾è®¡ï¼Œé€‚é…ä¸åŒå±å¹•

**åç»­ä¼˜åŒ–**:
- [ ] å®ç°ä¸ªäººä¿¡æ¯é¡µé¢
- [ ] å®ç°ç”Ÿæˆå†å²é¡µé¢
- [ ] å®ç°è®¾ç½®é¡µé¢
- [ ] æ·»åŠ ç”¨æˆ·ç§¯åˆ†æŸ¥è¯¢
- [ ] æ˜¾ç¤ºç”¨æˆ·ç­‰çº§/ä¼šå‘˜ç±»å‹
- [ ] æ·»åŠ ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯
- [ ] æ”¯æŒç”¨æˆ·å¤´åƒä¸Šä¼ 
- [ ] æ·»åŠ æ›´å¤šå¿«æ·æ“ä½œ

**çŠ¶æ€**: âœ… å·²å®Œæˆ - ç”¨æˆ·èœå•åŠŸèƒ½å¯ç”¨

---

## 2025-11-23 (æ™šä¸Š)

### ğŸ“± å®Œå–„ - ç§»åŠ¨ç«¯ç”¨æˆ·ä¿¡æ¯ç®¡ç†åŠŸèƒ½

**è¯´æ˜**: å®Œå–„ç§»åŠ¨ç«¯ç”¨æˆ·ä¿¡æ¯ç®¡ç†ç³»ç»Ÿï¼Œä¿®å¤ç”¨æˆ·ä¿¡æ¯è·å–é—®é¢˜ï¼Œå®ç°ä¸ªäººä¿¡æ¯ç¼–è¾‘ã€ç”Ÿæˆå†å²æŸ¥çœ‹å’Œåº”ç”¨è®¾ç½®ç­‰å®Œæ•´åŠŸèƒ½ã€‚

**æ–°å¢æ–‡ä»¶**:
- âœ… `mobile-app/app/profile/edit.tsx` - ä¸ªäººä¿¡æ¯ç¼–è¾‘é¡µé¢ (450è¡Œ)
- âœ… `mobile-app/app/history/index.tsx` - ç”Ÿæˆå†å²é¡µé¢ (420è¡Œ)
- âœ… `mobile-app/app/settings/index.tsx` - åº”ç”¨è®¾ç½®é¡µé¢ (380è¡Œ)

**ä¿®æ”¹æ–‡ä»¶**:
- âœ… `mobile-app/components/UserMenu.tsx` - ä¿®å¤ç”¨æˆ·ä¿¡æ¯è·å–ï¼Œæ·»åŠ ç§¯åˆ†æŸ¥è¯¢ï¼Œå®Œå–„é¡µé¢è·³è½¬

**æ ¸å¿ƒåŠŸèƒ½**:

### 1. ç”¨æˆ·ä¿¡æ¯è·å–ä¼˜åŒ–

**ä¿®å¤å‰é—®é¢˜**:
- æ— æ³•æ­£ç¡®è¯»å– Supabase ç”¨æˆ·æ•°æ®
- ç”¨æˆ·åæ˜¾ç¤ºä¸æ­£ç¡®
- ç¼ºå°‘è°ƒè¯•ä¿¡æ¯

**ä¿®å¤åé€»è¾‘**:
```typescript
// ç”¨æˆ·åè·å–ä¼˜å…ˆçº§
1. user.user_metadata.name        // ç”¨æˆ·è®¾ç½®çš„æ˜µç§°
2. user.user_metadata.full_name   // å…¨å
3. user.email.split('@')[0]       // é‚®ç®±ç”¨æˆ·å
4. user.phone (è„±æ•æ˜¾ç¤º)          // æ‰‹æœºå· (xxx****xxxx)
5. "ç”¨æˆ·" (é»˜è®¤)

// å¤´åƒé¦–å­—æ¯è·å–
1. name[0].toUpperCase()          // æ˜µç§°é¦–å­—æ¯
2. email[0].toUpperCase()         // é‚®ç®±é¦–å­—æ¯
3. "P" (æ‰‹æœºå·ç™»å½•)
4. "U" (é»˜è®¤)

// æ·»åŠ è°ƒè¯•æ—¥å¿—
console.log('User data:', user);
```

### 2. ä¸ªäººä¿¡æ¯ç¼–è¾‘é¡µé¢ (/profile/edit)

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… å¤§å¤´åƒå±•ç¤ºï¼ˆ80x80ï¼‰
- âœ… å§“åç¼–è¾‘
- âœ… æ€§åˆ«é€‰æ‹©ï¼ˆæœªæŒ‡å®š/ç”·/å¥³/å…¶ä»–ï¼‰
- âœ… é‚®ç®±æ˜¾ç¤ºï¼ˆä¸å¯ç¼–è¾‘ï¼‰
- âœ… æ‰‹æœºå·æ˜¾ç¤ºï¼ˆå¦‚æœæœ‰ï¼Œä¸å¯ç¼–è¾‘ï¼‰
- âœ… ä¿å­˜åˆ° Supabase profiles è¡¨
- âœ… ä¿å­˜æˆåŠŸåè‡ªåŠ¨è¿”å›

**UIè®¾è®¡**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [è¿”å›] ä¸ªäººä¿¡æ¯             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚        [å¤§å¤´åƒ]             â”‚
â”‚      æ›´æ¢å¤´åƒ               â”‚
â”‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å§“å                        â”‚
â”‚ [è¾“å…¥æ¡†]                    â”‚
â”‚                             â”‚
â”‚ æ€§åˆ«                        â”‚
â”‚ [æœªæŒ‡å®š] [ç”·] [å¥³] [å…¶ä»–]   â”‚
â”‚                             â”‚
â”‚ é‚®ç®±                        â”‚
â”‚ [æ˜¾ç¤ºæ¡† - ä¸å¯ç¼–è¾‘]         â”‚
â”‚                             â”‚
â”‚ [ä¿å­˜æŒ‰é’®]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®ä¿å­˜**:
```typescript
// Upsert åˆ° profiles è¡¨
await supabase
  .from('profiles')
  .upsert({
    id: user.id,
    name: name.trim(),
    gender: gender,
    updated_at: new Date().toISOString(),
  });

// åˆ·æ–°ç”¨æˆ·ä¿¡æ¯
await refreshUser();
```

### 3. ç”Ÿæˆå†å²é¡µé¢ (/history)

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… æ˜¾ç¤ºæœ€è¿‘ç”Ÿæˆè®°å½•ï¼ˆå›¾ç‰‡/è§†é¢‘ï¼‰
- âœ… ä¸‹æ‹‰åˆ·æ–°
- âœ… ç¼©ç•¥å›¾å±•ç¤º
- âœ… ç±»å‹å¾½ç« ï¼ˆå›¾ç‰‡/è§†é¢‘å›¾æ ‡ï¼‰
- âœ… Prompt æ˜¾ç¤ºï¼ˆæˆªæ–­50å­—ç¬¦ï¼‰
- âœ… æ—¶é—´æ˜¾ç¤ºï¼ˆæ™ºèƒ½æ ¼å¼ï¼šä»Šå¤©/æ˜¨å¤©/Nå¤©å‰ï¼‰
- âœ… ä¸‹è½½æŒ‰é’®ï¼ˆå¾…å®ç°ï¼‰
- âœ… æ¸…ç†å†å²è®°å½•åŠŸèƒ½
- âœ… ç©ºçŠ¶æ€å¼•å¯¼

**UIè®¾è®¡**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [è¿”å›] ç”Ÿæˆå†å²      [æ¸…ç†] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚ [ç¼©ç•¥å›¾] å›¾ç‰‡ç”Ÿæˆ           â”‚
â”‚  [ç±»å‹]  è®©å›¾ä¸­äººç‰©å¤§ç¬‘     â”‚
â”‚          ä»Šå¤© 14:30         â”‚
â”‚                       [ä¸‹è½½] â”‚
â”‚                             â”‚
â”‚ [ç¼©ç•¥å›¾] è§†é¢‘ç”Ÿæˆ           â”‚
â”‚  [ç±»å‹]  ä¸€åªå¯çˆ±çš„çŒ«       â”‚
â”‚          æ˜¨å¤© 10:15         â”‚
â”‚                       [ä¸‹è½½] â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®è·å–**:
```typescript
// è°ƒç”¨ API è·å–å†å²
const response = await fetch(getApiUrl('api/user/generations'), {
  method: 'GET',
  headers: {
    'Authorization': `Bearer ${session.access_token}`,
  },
});

const data = await response.json();
// data: Generation[] åŒ…å«æœ€è¿‘5æ¡è®°å½•
```

**æ—¶é—´æ ¼å¼åŒ–**:
```typescript
- 0å¤©: "ä»Šå¤© 14:30"
- 1å¤©: "æ˜¨å¤© 10:15"
- 2-6å¤©: "3å¤©å‰"
- 7å¤©+: "2024/11/20"
```

### 4. åº”ç”¨è®¾ç½®é¡µé¢ (/settings)

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… è´¦å·è®¾ç½®ï¼ˆä¸ªäººä¿¡æ¯/ä¿®æ”¹å¯†ç /è´¦å·å®‰å…¨ï¼‰
- âœ… é€šçŸ¥è®¾ç½®ï¼ˆæ¨é€é€šçŸ¥/é‚®ä»¶é€šçŸ¥ï¼‰
- âœ… åº”ç”¨è®¾ç½®ï¼ˆè¯­è¨€/ä¸»é¢˜/è‡ªåŠ¨æ’­æ”¾ï¼‰
- âœ… å…¶ä»–åŠŸèƒ½ï¼ˆæ¸…é™¤ç¼“å­˜/å…³äº/åè®®/éšç§ï¼‰
- âœ… é€€å‡ºç™»å½•ï¼ˆå±é™©åŒºåŸŸï¼‰
- âœ… ç‰ˆæœ¬ä¿¡æ¯æ˜¾ç¤º

**UIè®¾è®¡**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [è¿”å›] è®¾ç½®                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è´¦å·è®¾ç½®                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ‘¤ ä¸ªäººä¿¡æ¯          >  â”‚ â”‚
â”‚ â”‚ ğŸ”‘ ä¿®æ”¹å¯†ç           >  â”‚ â”‚
â”‚ â”‚ ğŸ›¡ï¸  è´¦å·å®‰å…¨          >  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚
â”‚ é€šçŸ¥è®¾ç½®                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ”” æ¨é€é€šçŸ¥     [å¼€å…³]  â”‚ â”‚
â”‚ â”‚ ğŸ“§ é‚®ä»¶é€šçŸ¥     [å¼€å…³]  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚
â”‚ åº”ç”¨è®¾ç½®                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸŒ è¯­è¨€è®¾ç½®  ç®€ä½“ä¸­æ–‡ > â”‚ â”‚
â”‚ â”‚ ğŸ¨ ä¸»é¢˜è®¾ç½®  è‡ªåŠ¨     > â”‚ â”‚
â”‚ â”‚ â–¶ï¸  è‡ªåŠ¨æ’­æ”¾     [å¼€å…³]  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚
â”‚ å±é™©åŒºåŸŸ                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸšª é€€å‡ºç™»å½•              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚
â”‚    Monna AI v1.0.0          â”‚
â”‚  Â© 2024 All Rights Reserved â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è®¾ç½®é¡¹åˆ†ç±»**:
1. **è´¦å·è®¾ç½®**: ä¸ªäººä¿¡æ¯ã€å¯†ç ã€å®‰å…¨
2. **é€šçŸ¥è®¾ç½®**: Switch å¼€å…³æ§åˆ¶
3. **åº”ç”¨è®¾ç½®**: è¯­è¨€ã€ä¸»é¢˜ã€æ’­æ”¾åå¥½
4. **å…¶ä»–**: ç¼“å­˜ã€å…³äºã€æ³•å¾‹æ–‡æ¡£
5. **å±é™©åŒºåŸŸ**: é€€å‡ºç™»å½•ï¼ˆçº¢è‰²é«˜äº®ï¼‰

### 5. ç”¨æˆ·ç§¯åˆ†æŸ¥è¯¢

**APIé›†æˆ**:
```typescript
// è°ƒç”¨ç»Ÿè®¡API
const response = await fetch(getApiUrl('api/user/stats'), {
  method: 'GET',
  headers: {
    'Authorization': `Bearer ${session.access_token}`,
  },
});

const data = await response.json();
setCredits(data.remainingCredits || 0);
setPlanName(data.planName || 'free');
```

**æ˜¾ç¤ºä¼˜åŒ–**:
- åŠ è½½æ—¶æ˜¾ç¤º Loading åŠ¨ç”»
- åŠ è½½å¤±è´¥æ˜¾ç¤º "--"
- æˆåŠŸåæ˜¾ç¤ºå®é™…æ•°å­—
- æ ¹æ®ç”¨æˆ·ç­‰çº§æ˜¾ç¤ºä¸åŒæ ‡ç­¾

### 6. é¡µé¢å¯¼èˆªæµç¨‹

```
ç”¨æˆ·èœå• (UserMenu)
  â”‚
  â”œâ”€ ä¸ªäººä¿¡æ¯ â†’ /profile/edit
  â”‚   â”œâ”€ ç¼–è¾‘å§“åå’Œæ€§åˆ«
  â”‚   â”œâ”€ ä¿å­˜åˆ°æ•°æ®åº“
  â”‚   â””â”€ è¿”å›èœå•
  â”‚
  â”œâ”€ ç”Ÿæˆå†å² â†’ /history
  â”‚   â”œâ”€ æŸ¥çœ‹å†å²è®°å½•
  â”‚   â”œâ”€ ä¸‹æ‹‰åˆ·æ–°
  â”‚   â”œâ”€ ä¸‹è½½ä½œå“
  â”‚   â””â”€ æ¸…ç†è®°å½•
  â”‚
  â”œâ”€ è®¾ç½® â†’ /settings
  â”‚   â”œâ”€ è´¦å·è®¾ç½®
  â”‚   â”œâ”€ é€šçŸ¥åå¥½
  â”‚   â”œâ”€ åº”ç”¨é…ç½®
  â”‚   â””â”€ é€€å‡ºç™»å½•
  â”‚
  â””â”€ é€€å‡ºç™»å½•
      â””â”€ äºŒæ¬¡ç¡®è®¤ â†’ è·³è½¬åˆ° /welcome
```

**æŠ€æœ¯å®ç°è¦ç‚¹**:

1. **æ•°æ®æŒä¹…åŒ–**:
   - ä½¿ç”¨ Supabase profiles è¡¨
   - Upsert æ“ä½œï¼ˆä¸å­˜åœ¨åˆ™æ’å…¥ï¼Œå­˜åœ¨åˆ™æ›´æ–°ï¼‰
   - è‡ªåŠ¨æ›´æ–° updated_at æ—¶é—´æˆ³

2. **æƒé™éªŒè¯**:
   - æ‰€æœ‰ API è¯·æ±‚æºå¸¦ Authorization header
   - ä½¿ç”¨ session.access_token é‰´æƒ
   - æœªç™»å½•è‡ªåŠ¨è·³è½¬åˆ°æ¬¢è¿é¡µ

3. **é”™è¯¯å¤„ç†**:
   - Try-catch æ•è·å¼‚å¸¸
   - Alert å‹å¥½æç¤º
   - Console.error è®°å½•æ—¥å¿—

4. **åŠ è½½çŠ¶æ€**:
   - åˆå§‹åŠ è½½ï¼šå…¨å± Loading
   - ä¸‹æ‹‰åˆ·æ–°ï¼šRefreshControl
   - ä¿å­˜æ“ä½œï¼šæŒ‰é’® Loading

**åç»­ä¼˜åŒ–**:
- [ ] å®ç°å¤´åƒä¸Šä¼ åŠŸèƒ½
- [ ] å®ç°å¯†ç ä¿®æ”¹åŠŸèƒ½
- [ ] å®ç°ä¸‹è½½åŠŸèƒ½
- [ ] æ·»åŠ è¯­è¨€åˆ‡æ¢åŠŸèƒ½
- [ ] æ·»åŠ ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
- [ ] å®ç°ç¼“å­˜ç®¡ç†
- [ ] æ·»åŠ ç”¨æˆ·ç»Ÿè®¡å›¾è¡¨

**çŠ¶æ€**: âœ… å·²å®Œæˆ - ç”¨æˆ·ä¿¡æ¯ç®¡ç†åŠŸèƒ½å®Œæ•´å¯ç”¨

---
